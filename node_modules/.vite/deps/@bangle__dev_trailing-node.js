import {
  assertNotUndefined
} from "./chunk-F3Z2TPKG.js";
import {
  Plugin,
  PluginKey
} from "./chunk-ZRMAPHIN.js";
import "./chunk-NVKSN2QT.js";
import "./chunk-AUZ3RYOM.js";

// .yarn/__virtual__/@bangle.dev-trailing-node-virtual-e572d22c8c/5/Users/ted/.yarn/berry/cache/@bangle.dev-trailing-node-npm-0.32.0-ca46591476-10c0.zip/node_modules/@bangle.dev/trailing-node/dist/index.js
var plugins = pluginsFactory;
var name = "trailing_node_addon";
function pluginsFactory({ node = "paragraph", notAfter = ["paragraph"] } = {}) {
  const plugin = new PluginKey(name);
  return ({ schema }) => {
    const disabledNodes = Object.entries(schema.nodes).map(([, value]) => value).filter((node2) => notAfter.includes(node2.name));
    const map = /* @__PURE__ */ new WeakMap();
    return [
      new Plugin({
        key: plugin,
        view: () => ({
          update: (view) => {
            const { state } = view;
            const { incorrectNodeAtEnd } = plugin.getState(state);
            if (!incorrectNodeAtEnd) {
              return;
            }
            if (map.has(view.state)) {
              return;
            }
            const { doc, schema: schema2, tr } = view.state;
            const type = schema2.nodes[node];
            assertNotUndefined(type, `Node ${node} not found in schema`);
            const transaction = tr.insert(doc.content.size, type.create());
            map.set(view.state, true);
            view.dispatch(transaction);
          }
        }),
        state: {
          init: (_, state) => {
            const lastChild = state.tr.doc.lastChild;
            return {
              incorrectNodeAtEnd: lastChild ? !disabledNodes.includes(lastChild.type) : false
            };
          },
          apply: (tr, value) => {
            if (!tr.docChanged) {
              return value;
            }
            const lastChild = tr.doc.lastChild;
            return {
              incorrectNodeAtEnd: lastChild ? !disabledNodes.includes(lastChild.type) : false
            };
          }
        }
      })
    ];
  };
}
var trailingNode = Object.freeze({
  __proto__: null,
  plugins
});
export {
  trailingNode
};
//# sourceMappingURL=@bangle__dev_trailing-node.js.map
