{
  "version": 3,
  "sources": ["../../../.yarn/__virtual__/@bangle.dev-trailing-node-virtual-e572d22c8c/5/Users/ted/.yarn/berry/cache/@bangle.dev-trailing-node-npm-0.32.0-ca46591476-10c0.zip/node_modules/@bangle.dev/trailing-node/dist/index.js"],
  "sourcesContent": ["import { PluginKey, Plugin } from '@bangle.dev/pm';\nimport { assertNotUndefined } from '@bangle.dev/utils';\n\nconst plugins = pluginsFactory;\nconst name = 'trailing_node_addon';\n// TODO can we move this to appendTransaction ?\nfunction pluginsFactory({ node = 'paragraph', notAfter = ['paragraph'], } = {}) {\n    const plugin = new PluginKey(name);\n    return ({ schema }) => {\n        const disabledNodes = Object.entries(schema.nodes)\n            .map(([, value]) => value)\n            .filter((node) => notAfter.includes(node.name));\n        const map = new WeakMap();\n        return [\n            new Plugin({\n                key: plugin,\n                view: () => ({\n                    update: (view) => {\n                        const { state } = view;\n                        const { incorrectNodeAtEnd } = plugin.getState(state);\n                        if (!incorrectNodeAtEnd) {\n                            return;\n                        }\n                        // TODO For some reason (unknown bug) this keeps getting called\n                        // with the same state, to prevent that, I have added this quick hack\n                        // And I have only seen it happen when loading md files\n                        if (map.has(view.state)) {\n                            return;\n                        }\n                        const { doc, schema, tr } = view.state;\n                        const type = schema.nodes[node];\n                        assertNotUndefined(type, `Node ${node} not found in schema`);\n                        const transaction = tr.insert(doc.content.size, type.create());\n                        map.set(view.state, true);\n                        view.dispatch(transaction);\n                    },\n                }),\n                state: {\n                    init: (_, state) => {\n                        const lastChild = state.tr.doc.lastChild;\n                        return {\n                            incorrectNodeAtEnd: lastChild\n                                ? !disabledNodes.includes(lastChild.type)\n                                : false,\n                        };\n                    },\n                    apply: (tr, value) => {\n                        if (!tr.docChanged) {\n                            return value;\n                        }\n                        const lastChild = tr.doc.lastChild;\n                        return {\n                            incorrectNodeAtEnd: lastChild\n                                ? !disabledNodes.includes(lastChild.type)\n                                : false,\n                        };\n                    },\n                },\n            }),\n        ];\n    };\n}\n\nvar trailingNode = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    plugins: plugins\n});\n\nexport { trailingNode };\n"],
  "mappings": ";;;;;;;;;;;AAGA,IAAM,UAAU;AAChB,IAAM,OAAO;AAEb,SAAS,eAAe,EAAE,OAAO,aAAa,WAAW,CAAC,WAAW,EAAG,IAAI,CAAC,GAAG;AAC5E,QAAM,SAAS,IAAI,UAAU,IAAI;AACjC,SAAO,CAAC,EAAE,OAAO,MAAM;AACnB,UAAM,gBAAgB,OAAO,QAAQ,OAAO,KAAK,EAC5C,IAAI,CAAC,CAAC,EAAE,KAAK,MAAM,KAAK,EACxB,OAAO,CAACA,UAAS,SAAS,SAASA,MAAK,IAAI,CAAC;AAClD,UAAM,MAAM,oBAAI,QAAQ;AACxB,WAAO;AAAA,MACH,IAAI,OAAO;AAAA,QACP,KAAK;AAAA,QACL,MAAM,OAAO;AAAA,UACT,QAAQ,CAAC,SAAS;AACd,kBAAM,EAAE,MAAM,IAAI;AAClB,kBAAM,EAAE,mBAAmB,IAAI,OAAO,SAAS,KAAK;AACpD,gBAAI,CAAC,oBAAoB;AACrB;AAAA,YACJ;AAIA,gBAAI,IAAI,IAAI,KAAK,KAAK,GAAG;AACrB;AAAA,YACJ;AACA,kBAAM,EAAE,KAAK,QAAAC,SAAQ,GAAG,IAAI,KAAK;AACjC,kBAAM,OAAOA,QAAO,MAAM,IAAI;AAC9B,+BAAmB,MAAM,QAAQ,IAAI,sBAAsB;AAC3D,kBAAM,cAAc,GAAG,OAAO,IAAI,QAAQ,MAAM,KAAK,OAAO,CAAC;AAC7D,gBAAI,IAAI,KAAK,OAAO,IAAI;AACxB,iBAAK,SAAS,WAAW;AAAA,UAC7B;AAAA,QACJ;AAAA,QACA,OAAO;AAAA,UACH,MAAM,CAAC,GAAG,UAAU;AAChB,kBAAM,YAAY,MAAM,GAAG,IAAI;AAC/B,mBAAO;AAAA,cACH,oBAAoB,YACd,CAAC,cAAc,SAAS,UAAU,IAAI,IACtC;AAAA,YACV;AAAA,UACJ;AAAA,UACA,OAAO,CAAC,IAAI,UAAU;AAClB,gBAAI,CAAC,GAAG,YAAY;AAChB,qBAAO;AAAA,YACX;AACA,kBAAM,YAAY,GAAG,IAAI;AACzB,mBAAO;AAAA,cACH,oBAAoB,YACd,CAAC,cAAc,SAAS,UAAU,IAAI,IACtC;AAAA,YACV;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ,CAAC;AAAA,IACL;AAAA,EACJ;AACJ;AAEA,IAAI,eAA4B,OAAO,OAAO;AAAA,EAC1C,WAAW;AAAA,EACX;AACJ,CAAC;",
  "names": ["node", "schema"]
}
